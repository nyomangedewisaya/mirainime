---
import logo from '../../assets/mirai.png'; // Pastikan path ini benar!
import { Icon } from 'astro-icon/components';
import ThemeToggle from '../ui/ThemeToggle.astro';

const pathname = Astro.url.pathname;

const navLinks = [
  { name: 'Anime', href: '/explore', icon: 'lucide:tv' },
  { name: 'Manga', href: '/manga', icon: 'lucide:book-open' },
  { name: 'Light Novel', href: '/light-novel', icon: 'lucide:book-text' },
  { name: 'Manhwa', href: '/manhwa', icon: 'lucide:smartphone' },
  { name: 'Manhua', href: '/manhua', icon: 'lucide:scroll' },
];

const extraMenu = [
  { name: 'Favorites', href: '/favorites', icon: 'lucide:heart' },
  { name: 'Schedule', href: '/schedule', icon: 'lucide:calendar-clock' },
  { name: 'Top Characters', href: '/characters', icon: 'lucide:users' },
  { name: 'Settings', href: '/settings', icon: 'lucide:settings' },
];

const isActive = (path: string) => pathname === path || pathname.startsWith(path + '/');
---

<header class="sticky top-0 z-50 w-full backdrop-blur-xl bg-white/80 dark:bg-slate-900/80 border-b border-slate-200/50 dark:border-slate-800/50 transition-colors duration-300">
  <div class="container mx-auto px-4 lg:px-8 h-20 flex items-center justify-between gap-4">
    
    <div class="flex items-center gap-8">
      <a href="/explore" class="flex items-center shrink-0">
        <img 
          src={logo.src} 
          alt="Mirai Logo" 
          class="h-15 w-auto md:h-18 object-contain" 
        />
      </a>

      <nav class="hidden md:flex items-center gap-6 text-sm font-medium">
        {navLinks.map((link) => (
          <a 
            href={link.href} 
            class={`transition-all duration-300 ${
              isActive(link.href) 
                ? 'text-primary-600 dark:text-primary-400 font-bold' 
                : 'text-slate-600 dark:text-slate-300 hover:text-primary-500'
            }`}
          >
            {link.name}
          </a>
        ))}
      </nav>
    </div>

    <div class="flex items-center gap-2 sm:gap-3">
      
      <ThemeToggle />
      
      <div class="hidden sm:flex items-center gap-2">
        <button class="px-4 py-2 text-sm font-medium text-slate-700 dark:text-slate-200 border border-slate-200 dark:border-slate-700 rounded-full hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors cursor-pointer">
          Login
        </button>
        <button class="px-4 py-2 text-sm font-medium text-white bg-primary-600 hover:bg-primary-500 rounded-full shadow-md shadow-primary-500/20 hover:shadow-primary-500/40 transition-all duration-300 transform active:scale-95 cursor-pointer">
          Sign Up
        </button>
      </div>

      <div class="relative" id="dropdown-wrapper">
        
        <button id="btn-dropdown" class="p-2 text-slate-600 dark:text-slate-400 hover:text-primary-600 dark:hover:text-primary-400 transition-colors cursor-pointer rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800/50 flex items-center justify-center" aria-label="Open menu">
          <Icon name="lucide:menu" class="w-6 h-6" />
        </button>

        <div id="popup-menu" class="absolute right-0 top-[calc(100%+0.5rem)] w-56 md:w-48 bg-white dark:bg-slate-800 rounded-2xl shadow-xl shadow-slate-200/50 dark:shadow-black/50 border border-slate-200 dark:border-slate-700/50 opacity-0 invisible translate-y-2 scale-95 origin-top-right transition-all duration-200 ease-out flex flex-col overflow-hidden z-50">
          
          <div class="md:hidden flex flex-col p-2 border-b border-slate-100 dark:border-slate-700/50">
            <span class="px-3 py-1.5 text-[10px] font-bold uppercase tracking-wider text-slate-400 dark:text-slate-500">Explore</span>
            {navLinks.map((link) => (
              <a 
                href={link.href} 
                class={`flex items-center gap-3 px-3 py-2 rounded-xl text-sm font-medium transition-colors ${
                  isActive(link.href) 
                    ? 'bg-primary-50 dark:bg-primary-900/20 text-primary-600 dark:text-primary-400' 
                    : 'text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700/50'
                }`}
              >
                <Icon name={link.icon} class="w-4 h-4 opacity-70" />
                {link.name}
              </a>
            ))}
          </div>

          <div class="flex flex-col p-2">
            <span class="px-3 py-1.5 text-[10px] font-bold uppercase tracking-wider text-slate-400 dark:text-slate-500">My Library</span>
            {extraMenu.map((item) => (
              <a 
                href={item.href} 
                class="flex items-center gap-3 px-3 py-2 rounded-xl text-sm font-medium text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700/50 hover:text-primary-600 dark:hover:text-primary-400 transition-colors"
              >
                <Icon name={item.icon} class="w-4 h-4 opacity-70" />
                {item.name}
              </a>
            ))}
          </div>

          <div class="sm:hidden flex flex-col gap-2 p-3 border-t border-slate-100 dark:border-slate-700/50 bg-slate-50/50 dark:bg-slate-900/30">
            <button class="w-full px-4 py-2 text-sm font-bold text-white bg-primary-600 hover:bg-primary-500 rounded-xl shadow-sm transition-colors cursor-pointer">
              Sign Up
            </button>
            <button class="w-full px-4 py-2 text-sm font-semibold text-slate-700 dark:text-slate-200 border border-slate-200 dark:border-slate-700 rounded-xl hover:bg-white dark:hover:bg-slate-800 transition-colors cursor-pointer">
              Log In
            </button>
          </div>

        </div>

      </div>
      
    </div>
  </div>
</header>

<script is:inline>
  const setupDropdown = () => {
    const wrapper = document.getElementById('dropdown-wrapper');
    const btn = document.getElementById('btn-dropdown');
    const menu = document.getElementById('popup-menu');

    if (!wrapper || !btn || !menu) return;

    btn.addEventListener('click', (e) => {
      e.stopPropagation(); 
      
      const isOpen = !menu.classList.contains('invisible');
      
      if (isOpen) {
        menu.classList.remove('opacity-100', 'translate-y-0', 'scale-100');
        menu.classList.add('opacity-0', 'invisible', 'translate-y-2', 'scale-95');
      } else {
        menu.classList.remove('opacity-0', 'invisible', 'translate-y-2', 'scale-95');
        menu.classList.add('opacity-100', 'translate-y-0', 'scale-100');
      }
    });

    document.addEventListener('click', (e) => {
      if (!wrapper.contains(e.target)) {
        menu.classList.remove('opacity-100', 'translate-y-0', 'scale-100');
        menu.classList.add('opacity-0', 'invisible', 'translate-y-2', 'scale-95');
      }
    });
  };

  setupDropdown();
  
  document.addEventListener('astro:after-swap', setupDropdown);
</script>