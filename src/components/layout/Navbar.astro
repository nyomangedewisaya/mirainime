---
import logo from '../../assets/mirai.png'; 
import { Icon } from 'astro-icon/components';
import ThemeToggle from '../ui/ThemeToggle.astro';

const pathname = Astro.url.pathname;

const navLinks = [
  { name: 'Anime', href: '/anime', icon: 'lucide:tv' },             
  { name: 'Aeni', href: '/aeni', icon: 'lucide:film' },             
  { name: 'Donghua', href: '/donghua', icon: 'lucide:monitor-play' }, 
  { name: 'Manga', href: '/manga', icon: 'lucide:book-open' },
  { name: 'Manhwa', href: '/manhwa', icon: 'lucide:smartphone' },
  { name: 'Manhua', href: '/manhua', icon: 'lucide:scroll' },
  { name: 'Novel', href: '/novel', icon: 'lucide:book-text' },
];

const extraMenu = [
  { name: 'Anime Schedule', href: '/anime/schedule', icon: 'lucide:tv' },
  { name: 'Donghua Schedule', href: '/donghua/schedule', icon: 'lucide:monitor-play' },
  { name: 'Favorites', href: '/favorites', icon: 'lucide:heart' },
  { name: 'Top Characters', href: '/character/top', icon: 'lucide:users' },
];

const isActive = (path: string) => pathname === path || pathname.startsWith(path + '/');
---

<header class="sticky top-0 z-50 w-full backdrop-blur-xl bg-white/80 dark:bg-slate-900/80 border-b border-slate-200/50 dark:border-slate-800/50 transition-colors duration-300">
  <div class="container mx-auto px-4 lg:px-8 h-15 lg:h-20 flex items-center justify-between gap-4">
    
    <a href="/anime" class="flex items-center shrink-0">
      <img 
        src={logo.src} 
        alt="Mirai Logo" 
        class="h-14 w-auto lg:h-18 object-contain" 
      />
    </a>

    <nav class="hidden md:flex items-center gap-1 md:gap-2">
      {navLinks.map((link) => (
        <a 
          href={link.href} 
          class={`relative flex items-center gap-1.5 px-3 py-2 md:px-3.5 md:py-2 rounded-xl text-sm font-semibold transition-all duration-300 group ${
            isActive(link.href) 
              ? 'text-primary-600 dark:text-primary-400 bg-primary-50 dark:bg-primary-900/20 shadow-sm' 
              : 'text-slate-600 dark:text-slate-300 hover:text-primary-600 dark:hover:text-primary-400 hover:bg-slate-50 dark:hover:bg-slate-800/50'
          }`}
        >
          <Icon 
            name={link.icon} 
            class={`w-4 h-4 transition-transform duration-300 ${
              isActive(link.href) 
                ? 'scale-110 opacity-100' 
                : 'opacity-70 group-hover:scale-110 group-hover:opacity-100'
            }`} 
          />
          <span>{link.name}</span>
        </a>
      ))}
    </nav>

    <div class="flex items-center gap-2 sm:gap-3">
      
      <ThemeToggle />

      <div class="relative" id="dropdown-wrapper">
        
        <button id="btn-dropdown" class="p-2 text-slate-600 dark:text-slate-400 hover:text-primary-600 dark:hover:text-primary-400 transition-colors cursor-pointer rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800/50 flex items-center justify-center" aria-label="Open menu">
          <Icon name="lucide:menu" class="w-6 h-6" />
        </button>

        <div id="popup-menu" class="absolute right-0 top-[calc(100%+0.5rem)] w-56 md:w-48 bg-white dark:bg-slate-800 rounded-2xl shadow-xl shadow-slate-200/50 dark:shadow-black/50 border border-slate-200 dark:border-slate-700/50 opacity-0 invisible translate-y-2 scale-95 origin-top-right transition-all duration-200 ease-out flex flex-col overflow-hidden z-50">
          
          <div class="md:hidden flex flex-col p-2 border-b border-slate-100 dark:border-slate-700/50">
            <span class="px-3 py-1.5 text-[10px] font-bold uppercase tracking-wider text-slate-400 dark:text-slate-500">Explore</span>
            {navLinks.map((link) => (
              <a 
                href={link.href} 
                class={`flex items-center gap-3 px-3 py-2 rounded-xl text-sm font-medium transition-colors ${
                  isActive(link.href) 
                    ? 'bg-primary-50 dark:bg-primary-900/20 text-primary-600 dark:text-primary-400' 
                    : 'text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700/50'
                }`}
              >
                <Icon name={link.icon} class="w-4 h-4 opacity-70" />
                {link.name}
              </a>
            ))}
          </div>

          <div class="flex flex-col p-2">
            <span class="px-3 py-1.5 text-[10px] font-bold uppercase tracking-wider text-slate-400 dark:text-slate-500">Menu</span>
            {extraMenu.map((item) => (
              <a 
                href={item.href} 
                class="flex items-center gap-3 px-3 py-2 rounded-xl text-sm font-medium text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700/50 hover:text-primary-600 dark:hover:text-primary-400 transition-colors"
              >
                <Icon name={item.icon} class="w-4 h-4 opacity-70" />
                {item.name}
              </a>
            ))}
          </div>

        </div>

      </div>
      
    </div>
  </div>
</header>

<script is:inline>
  const setupDropdown = () => {
    const wrapper = document.getElementById('dropdown-wrapper');
    const btn = document.getElementById('btn-dropdown');
    const menu = document.getElementById('popup-menu');

    if (!wrapper || !btn || !menu) return;

    btn.addEventListener('click', (e) => {
      e.stopPropagation(); 
      
      const isOpen = !menu.classList.contains('invisible');
      
      if (isOpen) {
        menu.classList.remove('opacity-100', 'translate-y-0', 'scale-100');
        menu.classList.add('opacity-0', 'invisible', 'translate-y-2', 'scale-95');
      } else {
        menu.classList.remove('opacity-0', 'invisible', 'translate-y-2', 'scale-95');
        menu.classList.add('opacity-100', 'translate-y-0', 'scale-100');
      }
    });

    document.addEventListener('click', (e) => {
      if (!wrapper.contains(e.target)) {
        menu.classList.remove('opacity-100', 'translate-y-0', 'scale-100');
        menu.classList.add('opacity-0', 'invisible', 'translate-y-2', 'scale-95');
      }
    });
  };

  setupDropdown();
  
  document.addEventListener('astro:after-swap', setupDropdown);
</script>