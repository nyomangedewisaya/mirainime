---
import ManhwaCard from '../../cards/ManhwaCard.astro';
import { fetchFromAniList } from '../../../lib/anilist';

const EXPLORE_QUERY = `
  query GetExploreManhwa {
    trending: Page(page: 1, perPage: 10) {
      media(sort: TRENDING_DESC, type: MANGA, countryOfOrigin: "KR", isAdult: false) {
        id
        title { romaji english }
        coverImage { large }
      }
    }
    
    popular: Page(page: 1, perPage: 10) {
      media(sort: POPULARITY_DESC, type: MANGA, countryOfOrigin: "KR", isAdult: false) {
        id
        title { romaji english }
        coverImage { large }
      }
    }
    
    releasing: Page(page: 1, perPage: 10) {
      media(sort: UPDATED_AT_DESC, type: MANGA, countryOfOrigin: "KR", status: RELEASING, isAdult: false) {
        id
        title { romaji english }
        coverImage { large }
      }
    }
  }
`;

const data = await fetchFromAniList({ query: EXPLORE_QUERY });

const trendingManhwa = data?.trending?.media || [];
const popularManhwa = data?.popular?.media || [];
const releasingManhwa = data?.releasing?.media || [];

const getTitle = (titleObj: any) => titleObj.english || titleObj.romaji;
---

<div class="flex flex-col gap-16 w-full fade-in-swap">
  
  <section>
    <div class="flex items-end justify-between mb-6">
      <h2 class="text-2xl font-bold text-slate-900 dark:text-white flex items-center gap-2">
        <span class="w-1.5 h-6 bg-primary-500 rounded-full"></span> Trending Manhwa
      </h2>
      <a href="/manhwa/trending" class="text-md font-medium text-primary-500 hover:text-primary-600 transition-colors hover:underline">View All</a>
    </div>
    <div class="grid grid-cols-2 md:grid-cols-5 gap-4 md:gap-6">
      {trendingManhwa.map((manhwa: any) => (
        <ManhwaCard 
          id={manhwa.id}
          title={getTitle(manhwa.title)} 
          image={manhwa.coverImage.large} 
        />
      ))}
    </div>
  </section>

  <section>
    <div class="flex items-end justify-between mb-6">
      <h2 class="text-2xl font-bold text-slate-900 dark:text-white flex items-center gap-2">
        <span class="w-1.5 h-6 bg-indigo-500 rounded-full"></span> Popular Manhwa
      </h2>
      <a href="/manhwa/popular" class="text-md font-medium text-primary-500 hover:text-primary-600 transition-colors hover:underline">View All</a>
    </div>
    <div class="grid grid-cols-2 md:grid-cols-5 gap-4 md:gap-6">
      {popularManhwa.map((manhwa: any) => (
        <ManhwaCard 
          id={manhwa.id}
          title={getTitle(manhwa.title)} 
          image={manhwa.coverImage.large} 
        />
      ))}
    </div>
  </section>

  <section>
    <div class="flex items-end justify-between mb-6">
      <h2 class="text-2xl font-bold text-slate-900 dark:text-white flex items-center gap-2">
        <span class="w-1.5 h-6 bg-emerald-500 rounded-full"></span> Recently Updated
      </h2>
      <a href="/manhwa/releasing" class="text-md font-medium text-primary-500 hover:text-primary-600 transition-colors hover:underline">View All</a>
    </div>
    <div class="grid grid-cols-2 md:grid-cols-5 gap-4 md:gap-6">
      {releasingManhwa.map((manhwa: any) => (
        <ManhwaCard 
          id={manhwa.id}
          title={getTitle(manhwa.title)} 
          image={manhwa.coverImage.large} 
        />
      ))}
    </div>
  </section>

</div>