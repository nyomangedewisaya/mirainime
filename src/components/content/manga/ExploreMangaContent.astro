---
import MangaCard from '../../cards/MangaCard.astro';
import { fetchFromAniList } from '../../../lib/anilist';

const EXPLORE_QUERY = `
  query GetExploreManga {
    trending: Page(page: 1, perPage: 10) {
      media(sort: TRENDING_DESC, type: MANGA, countryOfOrigin: "JP", format: MANGA, isAdult: false) {
        id
        title { romaji english }
        coverImage { large }
      }
    }
    
    popular: Page(page: 1, perPage: 10) {
      media(sort: POPULARITY_DESC, type: MANGA, countryOfOrigin: "JP", format: MANGA, isAdult: false) {
        id
        title { romaji english }
        coverImage { large }
      }
    }
    
    releasing: Page(page: 1, perPage: 10) {
      media(sort: START_DATE_DESC, type: MANGA, countryOfOrigin: "JP", format: MANGA, status: RELEASING, isAdult: false) {
        id
        title { romaji english }
        coverImage { large }
      }
    }
  }
`;

const data = await fetchFromAniList({ query: EXPLORE_QUERY });

const trendingManga = data?.trending?.media || [];
const popularManga = data?.popular?.media || [];
const releasingManga = data?.releasing?.media || [];

const getTitle = (titleObj: any) => titleObj.english || titleObj.romaji;
---

<div class="flex flex-col gap-16 w-full fade-in-swap">
  
  <section>
    <div class="flex items-end justify-between mb-6">
      <h2 class="text-2xl font-bold text-slate-900 dark:text-white flex items-center gap-2">
        <span class="w-1.5 h-6 bg-primary-500 rounded-full"></span> Trending Now
      </h2>
      <a href="/manga/trending" class="text-md font-medium text-primary-500 hover:text-primary-600 transition-colors hover:underline">View All</a>
    </div>
    <div class="grid grid-cols-2 md:grid-cols-5 gap-4 md:gap-6">
      {trendingManga.map((manga: any) => (
        <MangaCard 
          id={manga.id}
          title={getTitle(manga.title)} 
          image={manga.coverImage.large} 
        />
      ))}
    </div>
  </section>

  <section>
    <div class="flex items-end justify-between mb-6">
      <h2 class="text-2xl font-bold text-slate-900 dark:text-white flex items-center gap-2">
        <span class="w-1.5 h-6 bg-indigo-500 rounded-full"></span> All-Time Popular
      </h2>
      <a href="/manga/popular" class="text-md font-medium text-primary-500 hover:text-primary-600 transition-colors hover:underline">View All</a>
    </div>
    <div class="grid grid-cols-2 md:grid-cols-5 gap-4 md:gap-6">
      {popularManga.map((manga: any) => (
        <MangaCard 
          id={manga.id}
          title={getTitle(manga.title)} 
          image={manga.coverImage.large} 
        />
      ))}
    </div>
  </section>

  <section>
    <div class="flex items-end justify-between mb-6">
      <h2 class="text-2xl font-bold text-slate-900 dark:text-white flex items-center gap-2">
        <span class="w-1.5 h-6 bg-emerald-500 rounded-full"></span> Recently Releasing
      </h2>
      <a href="/manga/releasing" class="text-md font-medium text-primary-500 hover:text-primary-600 transition-colors hover:underline">View All</a>
    </div>
    <div class="grid grid-cols-2 md:grid-cols-5 gap-4 md:gap-6">
      {releasingManga.map((manga: any) => (
        <MangaCard 
          id={manga.id}
          title={getTitle(manga.title)} 
          image={manga.coverImage.large} 
        />
      ))}
    </div>
  </section>

</div>