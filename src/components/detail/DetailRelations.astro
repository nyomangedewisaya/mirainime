---
import { generateSlug } from '../../lib/utils';

interface Props {
  relations: {
    edges: Array<{
      relationType: string;
      node: {
        id: number;
        type: string;
        format: string;
        status: string;
        title: { romaji: string; english: string };
        coverImage: { large: string };
        countryOfOrigin?: string; 
      };
    }>;
  };
}
const { relations } = Astro.props;

const formatRelationType = (type: string) => {
  return type.replace(/_/g, ' ').toLowerCase().replace(/\b\w/g, l => l.toUpperCase());
};

const getRoutePrefix = (node: any) => {
  if (node.type === 'ANIME') return 'anime';
  if (node.format === 'NOVEL') return 'novel';
  if (node.countryOfOrigin === 'KR') return 'manhwa';
  if (node.countryOfOrigin === 'CN') return 'manhua';
  return 'manga'; 
};
---

<section class="container mx-auto px-4 lg:px-8 py-8 md:py-12 border-t border-slate-200/50 dark:border-slate-800/50">
  <div class="flex items-center gap-3 mb-6">
    <div class="h-8 w-1.5 bg-primary-500 rounded-full"></div>
    <h2 class="text-xl md:text-2xl font-bold text-slate-900 dark:text-white">Related Media</h2>
  </div>

  <div class="w-full overflow-x-auto custom-scrollbar pb-6 -mx-4 px-4 lg:mx-0 lg:px-0">
    <div class="flex gap-4 md:gap-5 min-w-max">
      {relations.edges.map((edge) => {
        const title = edge.node.title.english || edge.node.title.romaji;
        const slug = generateSlug(title);
        const routePrefix = getRoutePrefix(edge.node);
        
        return (
          <a href={`/${routePrefix}/${edge.node.id}/${slug}`} class="group flex flex-col w-32 md:w-40 shrink-0 gap-2.5 cursor-pointer">
            <div class="relative w-full aspect-3/4 rounded-2xl overflow-hidden shadow-sm group-hover:shadow-lg transition-shadow duration-300">
              <img 
                src={edge.node.coverImage.large} 
                alt={title} 
                class="w-full h-full object-cover transform group-hover:scale-105 transition-transform duration-500"
                loading="lazy"
              />
              <div class="absolute inset-0 bg-linear-to-t from-slate-900/80 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
              
              <div class="absolute top-2 left-2 px-2 py-1 bg-slate-900/80 backdrop-blur-sm text-white text-[10px] font-bold uppercase tracking-wider rounded-lg border border-white/10">
                {formatRelationType(edge.relationType)}
              </div>
            </div>
            
            <div class="flex flex-col">
              <span class="text-[10px] md:text-xs font-semibold text-primary-600 dark:text-primary-400 uppercase tracking-wider">
                {edge.node.format || edge.node.type}
              </span>
              <h3 class="text-sm font-bold text-slate-800 dark:text-slate-200 line-clamp-2 leading-tight group-hover:text-primary-500 transition-colors">
                {title}
              </h3>
            </div>
          </a>
        );
      })}
    </div>
  </div>
</section>